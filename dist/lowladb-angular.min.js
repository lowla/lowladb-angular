/*! lowladb-angular 2015-May-14 */
!function(a){"use strict";function b(){var a,b,c={datastore:"Memory"};this.setLowlaUrl=function(b){a=b},this.setConfig=function(a){angular.copy(c,a)},this.$get=["$location",function(d){return b||(a=a||d.protocol()+"://"+d.host()+":"+d.port(),b=new LowlaDB(c),b.sync(a)),b}]}function c(a){return function(b){var c=a.defer();return b.then(c.resolve,c.reject),c.promise}}function d(a,b,c,d,e){function g(h,i){function j(a){a.toArray().then(function(a){b(function(){l.$data.length=0,l.$data.push.apply(l.$data,a)})})}function k(a){var b=l.$data;if(angular.isNumber(a)&&a>=0&&a<b.length)return l.$data[a];if(angular.isObject(a)&&angular.isDefined(a._id)){for(var c=-1,d=0,e=b.length;e>d;d++)if(b[d]._id===a._id){c=d;break}if(-1!==c)return b[c]}return null}if(!(this instanceof g))return new g(h,i);var l=this;this.$defer=e,this.$data=[],i=i||d;var m=f(j,10);return h&&(this.$off=h.on(function(b,c){b?a.warn("LowlaDBArray: cursor error "+b):m(c)}),i&&this.$off&&i.$on("$destroy",this.$off),this.$data.$add=function(a){return e(h._collection.insert(a))},this.$data.$remove=function(a){var b=k(a);return b?e(h._collection.remove({_id:b._id})):c.reject("Invalid document or index")},this.$data.$save=function(a){var b=k(a);return b?e(h._collection.findAndModify({_id:b._id},a)):c.reject("Invalid document or index")}),this.$data}return g}function e(a,b,c){function d(e,f){function g(a){a.toArray().then(function(a){b(function(){h(),a.length>0&&a[0]&&angular.copy(a[0],i.$data)})})}function h(){for(var a in i.$data)i.$data.hasOwnProperty(a)&&delete i.$data[a]}if(!(this instanceof d))return new d(e,f);var i=this;return i.$data={},f=f||a,e&&(i.$off=e.on(function(a,b){a?c.warn("LowlaDBDocument: cursor error "+a):g(b)}),f&&this.$off&&f.$on("$destroy",this.$off)),i.$data}return d}function f(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}angular.module("lowladb",[]).value("LowlaDB",a.LowlaDB).provider("$lowla",b).factory("$lowlaArray",d).factory("$lowlaDocument",e).factory("$lowlaDefer",c),c.$inject=["$q"],d.$inject=["$log","$timeout","$q","$rootScope","$lowlaDefer"],e.$inject=["$rootScope","$timeout","$log"]}(window);